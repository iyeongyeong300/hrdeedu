<? include "../include/header.html"; ?>
<?
include "../include/login_check.php";
?>
<div class="wrap"><!-- wrap -->
<? include "../include/subtitle_mypage.html"; ?>
   
    <div class="navigation_wrap">
        <div class="navigation">
            <span class="home_icon"></span><span>></span>나의강의실<span>></span>수강관리<span>></span>학습종료 과정
        </div>
    </div>
    <div class="tabList_area">
        <ul class="tabList">
            <li>
                <a href="../mypage/lecture.html" class="tab_btn on">수강관리</a>
            </li>
            <li>
                <a href="../mypage/appaylecture.html" class="tab_btn">수강신청/결제관리</a>
            </li>
            <li>
                <a href="../mypage/datapick.html" class="tab_btn">자료/상담관리</a>
            </li>
            <?if($LoginEduManager=="Y") {?>
            <li>
                <a href="../mypage/manager_trainee.html" class="tab_btn">교육담당자</a>
            </li>         
            <? } ?>
            <li>
                <a href="../mypage/memberinfo.html" class="tab_btn">회원정보관리</a>
            </li>
        </ul>
    </div>
    <div class="tabList_area2">
        <ul class="tabList2">
            <li>
                <a href="../mypage/lecture.html" class="tab_btn">학습중인 과정</a>
            </li>
            <li>
                <a href="../mypage/lecture_review.html" class="tab_btn">복습중인 과정</a>
            </li>
            <li>
                <a href="../mypage/lecture_end.html" class="tab_btn on">학습종료 과정</a>
            </li>
        </ul>
    </div>
    <?
    $i = 0;

    $NowDate = date('Y-m-d');
    $SQL = "SELECT a.*, a.Seq AS Study_Seq, a.MidSaveTime, a.TestSaveTime, a.ReportSaveTime, a.MidIP, a.TestIP, a.ReportIP, a.PassOk, 
                b.PreviewImage, b.ContentsName, b.idx AS Course_idx, b.Mobile, b.Chapter, b.Limited, b.PassProgress, b.TotalPassMid, b.MidRate, b.TotalPassTest, b.TestRate, b.TotalPassReport, b.ReportRate, b.PassScore, b.attachFile, b.ctype, b.Professor, 
                c.CategoryName AS Category1Name, c.idx AS Category1_idx, 
                d.CategoryName AS Category2Name, d.idx AS Category2_idx, 
                e.Name AS TutorName, 
                (SELECT COUNT(idx) FROM Progress WHERE ID='$LoginMemberID' AND LectureCode=a.LectureCode AND Study_Seq=a.Seq) AS ProgressCount, 
                (SELECT COUNT(idx) FROM PaymentSheet WHERE CompanyCode=a.CompanyCode AND LectureStart=a.LectureStart AND LectureEnd=a.LectureEnd AND PayStatus='Y') AS PaymentCount 
                FROM Study AS a 
                LEFT OUTER JOIN Course AS b ON a.LectureCode=b.LectureCode 
                LEFT OUTER JOIN CourseCategory AS c ON b.Category1=c.idx 
                LEFT OUTER JOIN CourseCategory AS d ON b.Category2=d.idx 
                LEFT OUTER JOIN StaffInfo AS e ON a.Tutor=e.ID 
                WHERE a.ID='$LoginMemberID' AND a.StudyEnd='Y' ORDER BY a.PackageRef ASC, a.PackageLevel ASC, a.InputDate DESC";
    //echo $SQL;
    $QUERY = mysqli_query($connect, $SQL);
    if($QUERY && mysqli_num_rows($QUERY))
    {
        while($ROW = mysqli_fetch_array($QUERY))
        {
            extract($ROW);

            $Today = date("Y-m-d",time());

            $StudyProgressStatus = StudyProgressStatus($ServiceType,$LectureCode,$Study_Seq);
            $StudyProgressStatus_Array = explode("|",$StudyProgressStatus);

            $ProgressStep = $StudyProgressStatus_Array[0];
            $ProgressStepExplArr = explode("<br>",$StudyProgressStatus_Array[1]);
            $ProgressStepExpl = $ProgressStepExplArr[0];
            if ($ProgressStepExplArr[1]) $ProgressStepExpl2 = "(".$ProgressStepExplArr[1].")"; else $ProgressStepExpl2 = "";
            $PlayProgressVal = $StudyProgressStatus_Array[2];

            $PlayTimeArr = explode(",", $StudyProgressStatus_Array[3]);
            $PlayStudyTime = $PlayTimeArr[0];
            $PlayLectureTime = $PlayTimeArr[1];

            $PlayStepRate = round(($PlayStudyTime / $PlayLectureTime) * 100);
            $PlayProgressRate = round(($ProgressCount / $Chapter) * 100);

            if($PassOk=="Y") {
                $PassOkStatus = "수료";
                $PassOkStatusRate = 100;
            }else{
                $PassOkStatus = "미수료";
                $PassOkStatusRate = 0;
            }
    ?>
    <div class="lecture_header">
        <ul class="lecture_title">
            <li class="left"><?=$ContentsName?><span class="btn_02 small_org ml7">PC</span><?if($Mobile=="Y") {?><span class="btn_02 small_violet ml7">모바일</span><?}?></li>
            <li class="right">
            <?if($attachFile) {?><a href="/player/lecture_download.php?LectureCode=<?=$LectureCode?>" target="ScriptFrame"><span class="cursor">학습자료 다운로드</span></a><?}?>
            </li>
        </ul>
        <ul class="lecture_detail">
            <li class="lecture_detail_left">
                <div>
                    <div class="left_title">수강기간</div>
                    <div class="left_text"><?=$LectureStart?> ~ <?=$LectureEnd?></div>
                </div>
                <div>
                    <div class="left_title">내용전문가</div>
                    <div class="left_text font_red"><?=$Professor?></div>
                </div>
                <div>
                    <?if($PassOk=="Y") {?><button type="button" onclick="Javascript:CertificatePrint(<?=$Seq?>);" class="btn_04 on">수료증 출력</button><?}else{?><br><?}?>
                </div>
            </li>
            <li class="lecture_detail_right">
                <ul class="lecture_graph">
                    <li class="left">강의진도</li>
                    <li class="right graph_color_02"><?=$ProgressCount?>/<?=$Chapter?></li>
                    <li class="graph_bg">
                        <div class="graph graph_bg_02" style="width: <?=$PlayProgressRate?>%"></div>
                    </li>
                </ul>
                <ul class="lecture_graph">
                    <li class="left">진도율</li>
                    <li class="right graph_color_03"><?=$Progress?>%</li>
                    <li class="graph_bg">
                        <div class="graph graph_bg_03" style="width: <?=$Progress?>%"></div>
                    </li>
                </ul>
                <ul class="lecture_graph">
                    <li class="left">최종상태</li>
                    <li class="right graph_color_05"><?=$PassOkStatus?></li>
                    <li class="graph_bg">
                        <div class="graph graph_bg_05" style="width: <?=$PassOkStatusRate?>%"></div>
                    </li>
                </ul>
            </li>
        </ul>
    </div>
    <hr>
    <?
        $i++;
        }
    }else{
    ?>
    <div class="lecture_header">
        <ul class="lecture_title">
            <li class="left">학습이 종료된 과정이 없습니다.</li>
        </ul>
    </div>
    <?}?>

</div><!-- wrap --> 
<? include "../include/footer.html"; ?>























